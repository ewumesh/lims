
<div>
  <div class="row">
    <div class="db-content">
      <div class="top-view-page p-2 mb-3">
        <div class="row log-details p-3">
          <div class="col-md-12" *ngIf="reportDetails?.status === 'rejected'">
            <div class="alert alert-danger"> Sample rejected. Remarks: {{reportDetails?.remarks}}</div>
          </div>
          <div class="col-md-3">
            <div class="row mt-2">
              <p>Created By</p>
              <h4>{{userDetails?.first_name}} {{userDetails?.last_name}}</h4>
            </div>
            <div class="row">
              <p>Created at</p>
              <h4>{{reportDetails?.created_date | date: 'medium'}}</h4>
            </div>


          </div>
          <!-- <div class="col-md-3"></div> -->
          <div class="col-md-3">

            <div class="row">
              <p>Approve By</p>
              <h4 *ngIf="reportDetails.approved_by?.first_name">{{reportDetails.approved_by?.first_name}} {{reportDetails?.approved_by?.last_name}}</h4>
              <h4 class="text-muted" *ngIf="!reportDetails.approved_by?.first_name">N/A</h4>
            </div>

            <div class="row">
              <p>Approve At</p>
              <h4 *ngIf="reportDetails.approved_date">{{reportDetails.approved_date | date: 'medium'}}</h4>
              <h4 class="text-muted" *ngIf="!reportDetails.approved_date">N/A</h4>
            </div>
          </div>
          <div class="col-md-3">
            <div class="row">
              <p>Completed At</p>
              <h4 *ngIf="!reportDetails?.completed_date" class="text-muted">N/A</h4>
              <h4 *ngIf="reportDetails?.completed_date">{{reportDetails?.completed_date | date:'medium'}}</h4>
            </div>
            <!-- <div class="row mt-2">
                        <p>Rejected at</p>
                        <h4>Lorem</h4>
                    </div> -->
          </div>
          <div class="col-md-3 log-status">
            <span style="padding: 8px" class="badge badge-primary" [statusColor]="reportDetails.status">
              {{reportDetails.status}}</span>
          </div>
        </div>
      </div>
      <div class="view-page">
        <h3 class="view-page-heading">Sample Details</h3>
        <div class="row">
          <div class="col-md-4">
            <h4 class="mb-0">Sample ID</h4>
            <p>
              <span *ngIf="reportDetails?.id">{{reportDetails.id}}</span>
              <span *ngIf="!reportDetails?.id" class="text-muted">N/A</span>
            </p>
          </div>
          <div class="col-md-4">
            <h4 class="mb-0">Sample Name </h4>
            <p>{{reportDetails.name}}</p>
          </div>
          <div class="col-md-4">
            <h4 class="mb-0">Commodity </h4>
            <p>{{reportDetails?.commodity?.name}}</p>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
            <h4 class="mb-0">MFD</h4>
            <p>{{reportDetails.mfd | date}}</p>
          </div>
          <div class="col-md-4">
            <h4 class="mb-0">Best Before Date</h4>
            <p>{{reportDetails.dfb | date}}</p>
          </div>

          <div class="col-md-4">
            <h4 class="mb-0">Batch</h4>
            <p>{{reportDetails.batch}}</p>
          </div>
        </div>
        <div class="row">
          <div class="col-md-4">
            <h4 class="mb-0">Brand</h4>
            <p>{{reportDetails.brand}}</p>
          </div>

          <div class="col-md-4">
            <h4 class="mb-0">Purpose of Analysis</h4>
            <p>{{reportDetails?.purpose}}</p>
          </div>

          <div class="col-md-4">
            <h4 class="mb-0">Condition</h4>
            <p>{{reportDetails.condition}}</p>
          </div>

          <div class="col-md-4">
            <h4 class="mb-0">Sample Type</h4>
            <p>{{reportDetails?.sample_type || 'N/A'}}</p>
          </div>

          <div class="col-md-4">
            <h4 class="mb-0">Sample Quantity</h4>
            <p>{{reportDetails?.sample_quantity || 'N/A'}}</p>
          </div>

          <div class="col-md-4">
            <h4 class="mb-0">Number of Sample</h4>
            <p>{{reportDetails?.number_of_sample || 'N/A'}}</p>
          </div>

          <div class="col-md-4">
            <h4 class="mb-0">Sample units</h4>
            <p>{{reportDetails?.sample_units || 'N/A'}}</p>
          </div>
          
          <div class="col-md-4">
            <h4 class="mb-0">Amendments</h4>
            <p>{{reportDetails?.amendments || 'N/A'}}</p>
          </div>

          <div class="col-md-4">
            <h4 class="mb-0">Note</h4>
            <p>{{reportDetails?.note || 'N/A'}}</p>
          </div>
        </div>
      </div>


      <!-- {{reportDetails?.payment | json}} -->

      <div class="view-page mt-4 " *ngIf="reportDetails?.payment.length > 0">
        <h3 class="view-page-heading pb-0 mb-0">Payment Details</h3>
        <div class="row m-0 py-1" *ngFor="let p of reportDetails.payment">
          <div class="col-md-3">
            <h4 class="mb-0">Voucher No</h4>
            <p>{{p.voucher_number}}</p>
          </div>
          <div class="col-md-3">
            <h4 class="mb-0">Amount </h4>
            <p>{{p.amount || ''}}</p>
          </div>
          <div class="col-md-3">
            <h4 class="mb-0">Paid Date </h4>
            <p>{{p.created_date | date: 'medium'}}</p>
          </div>
  
          <div class="col-md-3">
            <h4 class="m-0">Payment Receipt </h4>
            <button  class="btn btn-primary btn-sm">View Receipt</button>
            <!-- <img (click)="viewReceipt(sampleDetails?.payment?.payment_receipt)" style="height: 60px;" [src]="sampleDetails?.payment?.payment_receipt" class="img-thumbnail cursor-pointer" /> -->
          </div>
          <hr class="m-0"/>
        </div>
        <!-- <div class="row">
          <div class="col-md-4">
            <h4>MFD</h4>
            <p>{{sampleDetails.mfd | date}}</p>
          </div>
          <div class="col-md-4">
            <h4>Best Before Date</h4>
            <p>{{sampleDetails.dfb | date}}</p>
          </div>
  
          <div class="col-md-4">
            <h4>Batch</h4>
            <p>{{sampleDetails.batch}}</p>
          </div>
        </div> -->
        <!-- <div class="row">
          <div class="col-md-4">
            <h4>Brand</h4>
            <p>{{sampleDetails.brand}}</p>
          </div>
  
          <div class="col-md-4">
            <h4>Purpose of Analysis</h4>
            <p>{{sampleDetails?.purpose}}</p>
          </div>
  
          <div class="col-md-4">
            <h4>Condition</h4>
            <p>{{sampleDetails.condition}}</p>
          </div>
        </div> -->
      </div>
      
  <div class="row m-0" *ngIf="reportDetails?.status !== 'rejected'">
    <div class="col-md-12 bg-white p-3 mt-3" style="border-radius: 5px;">
      <div class="row">
        <div class="col-md-6">
          <h2 class="mb-0">Sample Report</h2>
        </div>
        <div class="col-md-6 text-end">
          <button *ngIf="reportDetails?.language === 'en'" [disabled]="isLoadingDownloadBtn" (click)="downloadReport()" class="btn btn-primary btn-lims-primary btn-sm mx-1">
            <span *ngIf="!isLoadingDownloadBtn">Download Report</span>
                <span *ngIf="isLoadingDownloadBtn">
                  <i class="fa fa-circle-o-notch fa-spin"></i> Loading...
                </span>
          </button>

          <button *ngIf="reportDetails?.language === 'np'" [disabled]="isLoadingDownloadBtnN" (click)="downloadReportNepali()" class="btn  btn-primary btn-lims-danger btn-sm mx-1">
            <span *ngIf="!isLoadingDownloadBtnN">Download Report</span>
                <span *ngIf="isLoadingDownloadBtnN">
                  <i class="fa fa-circle-o-notch fa-spin"></i> Loading...
                </span>
          </button>
        </div>
      </div>
      
    </div>
  </div>

      <div class="view-page mt-3">
        <h3 class="view-page-heading">Parameter Details</h3>
        <div class="row">
          <div class="col-md-12">
            <table class="table table-bordered">
              <tr>
                <!-- <th></th> -->
                <th>S.N.</th>
                <th>Parameter Name</th>
                <th>Test Type</th>
                <th>Method</th>
                <th>Units</th>
                <!-- <th>Price</th> -->
                <th>Mandatory Standards</th>
                <th>Result</th>
                <!-- <th>Status</th> -->
              </tr>
              <tbody>
                <tr *ngFor="let r of reportDetails.parameters; let i = index;">
                  <!-- <td rowspan="3">
                    <tr>
                      <td>asdasd</td>

                    </tr>

                  </td> -->
                  <td>{{i+1}}</td>
                  <td>{{r.name | titlecase}}</td>
                  <td>
                    <span *ngIf="r.test_type">
                      {{r.test_type}}
                    <!-- <span *ngIf="r.test_type === '1'">Chemical Test</span>
                        <span *ngIf="r.test_type === '2'">Microbiological Test</span> -->
                        </span>
                        <span *ngIf="!r.test_type">N/A</span>
                  </td>
                  <td>
                    <span *ngIf="r.ref_test_method">
                      <span *ngIf="r.ref_test_method === 'nan'" class="text-muted">N/A</span>
                      <span *ngIf="r.ref_test_method !== 'nan'" class="text-muted">{{r.ref_test_method}}</span>
                      </span>
                    <span *ngIf="!r.ref_test_method" class="text-muted">N/A</span>

                  </td>
                  <td><span *ngIf="r.units">
                    <span *ngIf="r.units === 'nan'" class="text-muted">N/A</span>
                    <span *ngIf="r.units !== 'nan'" class="text-muted">{{r.units}}</span>
                    </span>
                  <span *ngIf="!r.units" class="text-muted">N/A</span></td>
                  <!-- <td>Rs.{{r.price}}</td> -->
                  <td>{{r.mandatory_standard}}</td>
                  <td>{{r?.result}}</td>
                  <!-- <td><span class="badge badge-primary" [statusColor]="r.status">{{r.status | titlecase}}</span></td> -->
                </tr>
              </tbody>
            </table>
          </div>

         <!-- <div class="col-md-12 text-end">
          <button class="btn btn-primary btn-sm mx-1">Download Report</button>
          <button class="btn btn-secondary btn-sm mx-1">Send for Verification</button>
         </div> -->
        </div>
      </div>
    </div>
  </div>

</div>

<div class="row" *ngIf="isLoading">
  <div class="col-md-12 text-center py-3">
    <div class="spinner-border text-dark" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>
</div>
